<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js"> <!--<![endif]-->

<head>
    <meta charset="utf-8">

    <title>景点展示</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <link rel="stylesheet" href="static/css/bootstrap.min.css">
    <link rel="stylesheet" href="static/css/animations.css">
    <link rel="stylesheet" href="static/css/font-awesome.min.css">
    <link rel="stylesheet" href="static/css/main.css">
    <script src="static/js/vendor/modernizr-2.6.2.min.js"></script>
    <!--[if lt IE 9]>
            <script src="static/js/vendor/respond.min.js"></script>
        <![endif]-->
</head>

<body>

    <header id="header" class="light_section">
        <div class="container">
            <div class="row">
                <div class="col-sm-4">
                    <div class="logo">
                        <img src="static/example/logo-.png" alt="" style="height: 80px;"></a>
                    </div>
                </div>
                <!-- <a class="navbar-brand" href="#top"><img src="static/example/logo.png" alt=""></a> -->
                <div class="col-sm-8 mainmenu_wrap">
                    <div class="main-menu-icon visible-xs">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <nav>
                        <ul id="mainmenu" class="menu sf-menu responsive-menu superfish">
                            <li class="">
                                <a href="./travelhome">首页</a>
                            </li>
                            <li class="active">
                                <a href="./gallery.html">景点搜索</a>
                            </li>
                            <li class="">
                                <a href="./route_design.html">景点路线规划</a>
                            </li>
                            <li class="dropdown">
                                <a href="./blog.html">博客</a>
                                <ul class="dropdown-menu">
                                    <li class="">
                                        <a href="./blog.html">博客</a>
                                    </li>
                                    <li class="">
                                        <a href="./blog-single.html">博客文章</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="">
                                <a href="./about.html">关于</a>
                            </li>
                            {% if user.is_authenticated %}
                            <li class="dropdown">
                                <a href="#" style="color: #333;">欢迎您，{{ user.username }}</a>
                                <ul class="dropdown-menu">
                                    <li class="">
                                        <a href="{% url 'logout' %}">退出登录</a>
                                    </li>
                                </ul>
                            </li>
                            {% else %}
                            <li class="">
                                <a href="{% url 'login' %}" style="color: #333;">点击此处登录</a>
                            </li>
                            {% endif %}
                            <!-- <li class="">
                                <a href="./contact.html">联系</a>
                            </li> -->
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <section id="middle" class="grey_section">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 text-center">
                    <h2 class="block-header">北京著名旅游景点</h2>
                    寻找你喜欢的景点
                </div>
            </div>
            <div class="row" style="margin-bottom: 20px; margin-top: 20px;">
                <div class="col-sm-6 col-sm-offset-3">
                    <div class="input-group">
                        <input type="text" id="gallery-search" class="form-control" placeholder="搜索景点名称或描述...">
                        <span class="input-group-btn">
                            <button id="gallery-search-btn" class="btn btn-primary" type="button">搜索</button>
                            <button id="gallery-reset-btn" class="btn btn-default" type="button">重置</button>
                        </span>
                    </div>
                </div>
            </div>
            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    var searchInput = document.getElementById('gallery-search');
                    var searchBtn = document.getElementById('gallery-search-btn');
                    var resetBtn = document.getElementById('gallery-reset-btn');
                    var galleryGrid = document.getElementById('gallery-grid');
                    
                    // 修改搜索函数以匹配当前DOM结构
                    function filterGallery() {
                        var keyword = searchInput.value.trim().toLowerCase();
                        // 搜索div元素而非li元素
                        var items = galleryGrid.querySelectorAll('.col-sm-3');
                        
                        Array.from(items).forEach(function (item) {
                            var title = item.querySelector('h3').textContent.toLowerCase();
                            // 从图片的data属性获取描述
                            var img = item.querySelector('img.modal-trigger');
                            var desc = img ? img.dataset.description.toLowerCase() : '';
                            
                            if (title.includes(keyword) || desc.includes(keyword)) {
                                item.style.display = '';
                            } else {
                                item.style.display = 'none';
                            }
                        });
                    }
                    
                    // 添加缺失的重置函数
                    function resetGallery() {
                        searchInput.value = '';
                        var items = galleryGrid.querySelectorAll('.col-sm-3');
                        Array.from(items).forEach(function (item) {
                            item.style.display = '';
                        });
                    }
                    searchBtn.addEventListener('click', filterGallery);
                    searchInput.addEventListener('keydown', function (e) {
                        if (e.key === 'Enter') {
                            filterGallery();
                        }
                    });
                    resetBtn.addEventListener('click', resetGallery);
                });
            </script>

            <div id="gallery-grid">
                {% for row in grouped_spots %}
                <div class="row">
                {% for spot in row %}
                <div class="col-sm-3">
                    <div class="gallery-item">
                        <img src="{{ spot.src }}" class="img-responsive modal-trigger" 
                            alt="" data-description="{{ spot.description }}">
                        <div class="gallery-item-content">
                            <h3>{{ spot.title }}</h3>
                        </div>
                    </div>
                </div>
                {% endfor %}
                </div>
                {% endfor %}
            </div>

            <div id="description-modal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <p id="modal-description"></p>
                </div>
            </div>
            <style>
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 999;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.5);
                }
                .modal-content {
                    background-color: #fff;
                    margin: 15% auto;
                    padding: 20px;
                    width: 60%;
                    border-radius: 5px;
                }
                .close {
                    float: right;
                    cursor: pointer;
                }
            </style>
            <div class="pagination">
                {% if current_page > 1 %}
                    <a href="?page={{ current_page|add:-1 }}">&laquo; 上一页</a>
                {% endif %}
                
                {% for p in page_range %}
                    {% if p == current_page %}
                        <a class="active" href="?page={{ p }}">{{ p }}</a>
                    {% else %}
                        <a href="?page={{ p }}">{{ p }}</a>
                    {% endif %}
                {% endfor %}
                
                {% if current_page < total_pages %}
                    <a href="?page={{ current_page|add:1 }}">下一页 &raquo;</a>
                {% endif %}
            </div>
            <style>
                .pagination {
                    display: block !important; 
                    margin-top: 20px;
                    text-align: center;
                }
                .pagination a {
                    padding: 8px 16px;
                    text-decoration: none;
                    border: 1px solid #ddd;
                    margin: 0 4px;
                }
                .pagination a.active {
                    background-color: #4CAF50;
                    color: white;
                    border: 1px solid #4CAF50;
                }
            </style>
            <script>
                document.addEventListener('click', function(e) {
                const modal = document.getElementById('description-modal');
                if (e.target.classList.contains('modal-trigger')) {
                    document.getElementById('modal-description').textContent = 
                    e.target.dataset.description;
                    modal.style.display = 'block';
                } else if (e.target.classList.contains('close') || e.target === modal) {
                    modal.style.display = 'none';
                }
                });
                function loadGalleryData(page) {
                    fetch(`/gallery_api?page=${page}`)
                        .then(response => response.json())
                        .then(data => {
                            // 更新景点数据
                            const galleryGrid = document.getElementById('gallery-grid');
                            galleryGrid.innerHTML = '';
                            
                            data.grouped_spots.forEach(row => {
                                const rowDiv = document.createElement('div');
                                rowDiv.className = 'row';
                                
                                row.forEach(spot => {
                                    const colDiv = document.createElement('div');
                                    colDiv.className = 'col-sm-3';
                                    colDiv.innerHTML = `
                                        <div class="gallery-item">
                                            <img src="${spot.src}" class="img-responsive modal-trigger" 
                                                alt="" data-description="${spot.description}">
                                            <div class="gallery-item-content">
                                                <h3>${spot.title}</h3>
                                            </div>
                                        </div>
                                    `;
                                    rowDiv.appendChild(colDiv);
                                });
                                galleryGrid.appendChild(rowDiv);
                            });
                            
                            // 更新当前页码状态
                            document.querySelectorAll('.pagination a').forEach(link => {
                                link.classList.remove('active');
                                if (link.getAttribute('href').includes(`page=${data.current_page}`)) {
                                    link.classList.add('active');
                                }
                            });
                        });
                }
                
                // 页面加载时获取第一页数据
                document.addEventListener('DOMContentLoaded', function() {
                    loadGalleryData(1);
                });
            </script>
        </div>
    </section>

    <footer>
        <div class="social">
            <div class="social_icons">
                <a class="social-icons__sep" href="#"><i class="fa fa-twitter"></i></a>
                <a class="social-icons__sep" href="#"><i class="fa fa-facebook"></i></a>
                <a class="social-icons__sep" href="#"><i class="fa fa-pinterest"></i></a>
                <a class="social-icons__sep" href="#"><i class="fa fa-google-plus"></i></a>
                <a href="#"><i class="fa fa-rss"></i></a>
            </div>
            <img alt="" src="static/example/footer_bg.jpg">
        </div>
    </footer>

    <section id="copyright" class="color_section">
        <div class="container">
            <div class="row">

                <div class="col-sm-12 text-center">
                    &copy; UCAS 2024 - Travel Planning
                </div>
            </div>

        </div>
    </section>


    <div class="preloader">
        <div class="preloaderimg"></div>
    </div>

    <script src="static/js/vendor/jquery-1.11.1.min.js"></script>
    <script src="static/js/vendor/jquery-migrate-1.2.1.min.js"></script>
    <script src="static/js/vendor/bootstrap.min.js"></script>
    <script src="static/js/vendor/placeholdem.min.js"></script>
    <script src="static/js/vendor/hoverIntent.js"></script>
    <script src="static/js/vendor/superfish.js"></script>
    <script src="static/js/vendor/jquery.actual.min.js"></script>
    <script src="static/js/vendor/jquery.appear.js"></script>
    <script src="static/js/vendor/jquerypp.custom.js"></script>
    <script src="static/js/vendor/jquery.elastislide.js"></script>
    <script src="static/js/vendor/jquery.flexslider-min.js"></script>
    <script src="static/js/vendor/jquery.prettyPhoto.js"></script>
    <script src="static/js/vendor/jquery.easing.1.3.js"></script>
    <script src="static/js/vendor/jquery.ui.totop.js"></script>
    <script src="static/js/vendor/jquery.isotope.min.js"></script>
    <script src="static/js/vendor/jquery.easypiechart.min.js"></script>
    <script src='static/js/vendor/jflickrfeed.min.js'></script>
    <script src="static/js/vendor/jquery.sticky.js"></script>
    <script src='static/js/vendor/owl.carousel.min.js'></script>
    <script src='static/js/vendor/jquery.nicescroll.min.js'></script>
    <script src='static/js/vendor/jquery.fractionslider.min.js'></script>
    <script src='static/js/vendor/jquery.scrollTo-min.js'></script>
    <script src='static/js/vendor/jquery.localscroll-min.js'></script>
    <script src='static/js/vendor/jquery.parallax-1.1.3.js'></script>
    <script src='static/js/vendor/jquery.bxslider.min.js'></script>
    <script src='static/js/vendor/jquery.funnyText.min.js'></script>
    <script src='static/js/vendor/jquery.countTo.js'></script>
    <script src="static/js/vendor/grid.js"></script>
    <script src="static/js/plugins.js"></script>
    <script src="static/js/main.js"></script>


</body>

</html>
